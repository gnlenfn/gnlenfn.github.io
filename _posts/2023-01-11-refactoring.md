---
title: "내가 짠 코드 리팩토링 하기"
excerpt: ""

categories:
  - web
tags:
  - ["python", "refactoring"]

date_created: 2022-01-11T22:20:00+09:00
last_modified_at: 2023-11-10T20:01:06+09:00
toc: true
toc_sticky: true
---

## Airflow DAG 코드 리팩토링 하기
지난 8월말 에어플로우 DAG를 만들 일이 있었다. python으로 데이터를 변형하여 opensearch로 저장하는 작업을 airflow로 스케쥴링 하고 파이프라인을 구축했다. 그런데 그때는 기한이 촉박하여 일단 되는대로 하드코딩도 많이하고 반복작업에 대해 복붙을 많이 사용했다. 그리고 이게 내가 항상 관리하고 보는 코드가 아니고 고객사에서 쓰는 코드다보니 내가 볼 일도 없고.. 개선이 시급하지만 내가 볼 일이 없다보니 잊혀져서 넣어놨던 코드였다. 하지만 어떻게 바꾸면 좋겠다 라는 부분은 항상 가지고 있었다.

## 클린코드?
흔히들 [클린코드 ](http://www.yes24.com/Product/Goods/11681152) 책이나 이런걸 보면서 클린코드에 대해 공부하는데, 나는 따로 공부해본 적은 없다. 다만 내가 보기 편하게, 파이썬의 경우 PEP8에 맞춘 스타일 뭐 이정도로만 생각하고 코드를 작성해왔다. 그런데 지난 1년간 회사에서 일하면서 클린 코드에 가장 영향을 미치는 것은 변수명, 함수명, 주석 이런 것 보다는 코드의 구조가 더 중요하지 않나 생각이 들었다. 내가 작성한 파이썬 코드는 정말 역할만 충실히 하는 함수만 나열해둔 형태이고 객체 지향과 같은 전체적인 구조에서는 매우 초보적인 코드였다. 
그래서 이 부분을 개선하고자 클래스를 만들고 반복을 줄이고 겸사겸사 변수명도 바꿔보려고 했다.

## 시작의 중요성
어제 새로운 데이터 수집이 필요하다 하여 전에 작성한 코드를 꺼내 다시 보면서 리팩토링하기로 다짐을 했고 새로운 기능도 추가되어야 했다. 그런데 새로운 기능을 추가하는 것 자체는 그냥 원래 코드들 복붙해다가 쓰면 그래도 빨리 할 수 있을 것 같았는데, 전체적인 디렉토리 구조부터 코드 스타일들을 바꾸려니 어디서부터 손을 대야 할 지 감이 안잡혔다. 리팩토링이 정말 말처럼 쉽지 않다는 것을 몸소 체험할 수 있었다. 
만약 이 코드를 처음 작성할 당시에 조금 더 고민을 하여 클린 코드를 지향하도록 작성했다면 오히려 더 쉬웠을 것 같다. 빈 도화지에 새로 그리는 작업이니까. 그런데 이제는 이미 기능은 다 동작하고 있고 거기서 코드를 바꾸려서 쉽지 않았다. 
그래도 먼저 디렉토리 구조를 개선하고 나니 어떤 방향으로 나아갈지 보이는 것 같아서 그렇게 감을 잡고 시작했다.

## 파이썬의 객체지향?
파이썬을 처음 배우면서 객체 지향에 대해 항상 공부하게 되는데, 그때는 클래스와 객체를 만들어보는 것이 객체 지향에 대한 공부였다. 그래서 나도 그렇게만 알고 있었고. 그런데 자바 스프링을 공부하면서 객체 지향은 클래스 쓰고 하는게 중요한것이 아니고 객체 지향의 원칙 SOLID를 지켜가면서 코드를 작성하는 것을 더 와닿게 느꼈다. 
그래서 나의 에어플로우 코드를 뜯어보면 동일한 작업을 참 많이 반복한다. 수집 시간을 체크하고, pandas 데이터 프레임을 병합하고, 다시 json 형태의 데이터를 parquet로 저장하는 등 여러 작업을 서로 다른 대상에게 반복한다. 그래서 클래스를 만들면 딱 좋겠다고 생각했다. 다형성을 적용했다고 할 수 있으려나?
그래도 모든 것을 완벽하게 같은 클래스로 사용할 수는 없어서 기존의 코드를 그대로 사용하기도 했다.

## 리팩토링 결과?
아직 전체 코드에서 30% 정도면 작업을 진행했다. 오늘 시작했기 떄문에 아직은 좀 더 들여다 봐야 할 것 같다. 일단 한 부분을 리팩토링하고 기능이 제대로 동작하는지까지 확인 했는데, 사실 아직 제대로 돌아가지 않았다. 오후에 회의가 계속 있어서 작업을 이어서 못했다. 하지만 이 부분을 넘어가면 다른 부분의 코드들이 대부분 비슷한 형태를 가지고 있기 때문에 오늘 작성한 코드와 크게 달라지지 않을 것이라고 생각한다. 
이렇게 말로 들으면 모두 아울러서 하나의 클래스가 될 수 있는 것 아닌가? 싶기도 한데 아직까지는 그런 아이디어가 없어서 각 영역별 클래스를 만드는 것으로 구상하고 있다. 
뭐 하나씩 하다보면 진짜 클린 코드가 될 수 있겠지.